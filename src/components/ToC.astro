---
/**
 * Table of Contents (目次) コンポーネント
 * ブログ記事などの見出しリンクを表示する
 */

interface ToCLink {
  depth: number;
  text: string;
  slug: string;
}

export interface Props {
  links: ToCLink[];
}

const { links } = Astro.props;

/**
 * 「」の内側の文字列を取得する関数
 * 例: 「はじめに」 → はじめに
 */
function getDisplayText(text: string, slug: string): string {
  const match = text.match(/「(.*?)」/);
  return match ? match[1] : slug;
}

/**
 * depth に応じたインデントクラスのマッピング
 * Tailwindの動的クラス生成を避け、明示的にクラスを定義
 */
const indentClasses: Record<number, string> = {
  2: 'ml-12',
  3: 'ml-16',
  4: 'ml-20',
  5: 'ml-24',
  6: 'ml-28',
};

function getIndentClass(depth: number): string {
  return indentClasses[depth] ?? 'ml-12';
}
---

<nav class="block" aria-label="目次">
  {
    links.length === 0 ? (
      <p class="text-gray-500">目次がありません</p>
    ) : (
      (() => {
        let counter = 1;
        return links.map((link) => {
          const { depth, text, slug } = link;
          const displayText = getDisplayText(text, slug);

          if (depth === 1) {
            const currentCounter = counter;
            counter++;
            return (
              <div class="w-full text-gray-500 hover:bg-gray-100">
                <a class="flex items-center" href={`#${slug}`}>
                  <span class="mr-4 inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-500 px-4 text-white">
                    {currentCounter}
                  </span>
                  <p class="py-[6px] text-lg font-semibold">{displayText}</p>
                </a>
              </div>
            );
          } else {
            return (
              <div class="w-full text-gray-500 hover:bg-gray-100">
                <a class="flex items-center" href={`#${slug}`}>
                  <p class={`py-[4px] text-base ${getIndentClass(depth)}`}>
                    {displayText}
                  </p>
                </a>
              </div>
            );
          }
        });
      })()
    )
  }
</nav>
